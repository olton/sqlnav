{"version":3,"file":"index.js","sources":["../../client_app/js/view.js","../../client_app/js/ws.js","../../client_app/js/ws-controller.js","../../client_app/js/index.js"],"sourcesContent":["export default class View {\r\n    pageIndex = 1\r\n\r\n    constructor() {\r\n        this.createEvents()\r\n    }\r\n\r\n    createEvents(){\r\n        $(document).on('click', '#explorer-toggle', () => {\r\n            $(\"html\").removeClass(\"no-explorer\")\r\n        });\r\n        $(document).on('click', '#explorer-hide', () => {\r\n            $(\"html\").addClass(\"no-explorer\")\r\n        });\r\n        $(document).on('click', '#add-ds', () => {\r\n            this.showAddDataSourceDialog()\r\n        });\r\n        $(document).on('click', '#new-editor', () => {\r\n            this.createEditor()\r\n        });\r\n    }\r\n\r\n    createEditor(text = ''){\r\n        const pc = Metro.getPlugin(\"#pc\", \"page-control\")\r\n        pc.addTab({\r\n            caption: `Unnamed ${this.pageIndex}`,\r\n            ref: `#content${this.pageIndex}`\r\n        })\r\n\r\n        $(\"<div>\")\r\n            .id(`content${this.pageIndex}`)\r\n            .addClass(\"content-window\")\r\n            .html(`\r\n                <div data-role=\"splitter\" data-split-mode=\"vertical\" data-split-sizes=\"100, 0\" data-gutter-size=\"10\" class=\"gutter-style-dotted\">\r\n                    <div class=\"sql-editor\" id=\"editor${this.pageIndex}\"></div>\r\n                    <div class=\"sql-result\" id=\"result${this.pageIndex}\"></div>\r\n                </div>\r\n            `)\r\n            .appendTo(\"#content-holder\")\r\n\r\n        monaco.editor.create($(`#editor${this.pageIndex}`)[0], {\r\n            value: text,\r\n            language: 'sql'\r\n        })\r\n\r\n        this.pageIndex++\r\n    }\r\n\r\n    showAddDataSourceDialog(){\r\n        Metro.dialog.create({\r\n            title: `Add Data Source`,\r\n            content: `\r\n                <form>\r\n                    <div>\r\n                        <label>Data Source Name</label>\r\n                        <input data-role=\"input\" type=\"text\" name=\"ds-name\" data-prepend=\"<span class='mif-database'>\">\r\n                    </div>\r\n                    <div class=\"mt-1\">\r\n                        <label>User</label>\r\n                        <input data-role=\"input\" type=\"text\" name=\"ds-user\" autocomplete=\"username\" data-prepend=\"<span class='mif-user'>\">\r\n                    </div>\r\n                    <div class=\"mt-1\">\r\n                        <label>Password</label>\r\n                        <input data-role=\"input\" type=\"password\" name=\"ds-password\" autocomplete=\"new-password\" data-prepend=\"<span class='mif-lock'>\">\r\n                    </div>                        \r\n                </form>\r\n            `,\r\n            actions: [\r\n                {\r\n                    caption: \"Add Data Source\",\r\n                    cls: \"js-dialog-close info\",\r\n                    onclick: function(){\r\n                    }\r\n                },\r\n                {\r\n                    caption: \"Cancel\",\r\n                    cls: \"js-dialog-close\",\r\n                },\r\n            ],\r\n            actionsAlign: \"left\"\r\n        })\r\n    }\r\n}\r\n","export default class WS {\r\n    ws = null\r\n    controller = null\r\n\r\n    constructor(options) {\r\n        this.controller = options.controller\r\n        this.connect(options)\r\n\r\n        this.ws.onmessage = event => {\r\n            try {\r\n                const content = JSON.parse(event.data)\r\n                if (typeof this.controller === 'function') {\r\n                    this.controller.apply(null, [ws, content])\r\n                }\r\n            } catch (e) {\r\n                console.log(e.message)\r\n                console.log(event.data)\r\n                console.log(e.stack)\r\n            }\r\n        }\r\n\r\n        this.ws.onerror = error => {\r\n            console.error('Socket encountered error: ', error.message, 'Closing socket');\r\n            this.ws.close();\r\n        }\r\n\r\n        this.ws.onclose = event => {\r\n            console.log('Socket is closed. Reconnect will be attempted in 1 second.', event.reason);\r\n            setTimeout(this.connect, 1000)\r\n        }\r\n\r\n        this.ws.onopen = event => {\r\n            console.log('Connected to SQL Navigator, wait for welcome message!');\r\n        }\r\n    }\r\n\r\n    isOpen(){\r\n        return this.ws && this.ws.readyState === WebSocket.OPEN;\r\n    }\r\n\r\n    send(channel, data) {\r\n        if (this.isOpen()) {\r\n            this.ws.send(JSON.stringify({channel, data}));\r\n        }\r\n    }\r\n\r\n    connect({host = \"localhost\", secure = false} = {}){\r\n        this.ws = new WebSocket(`${secure ? 'wss' : 'ws'}://${host}`)\r\n    }\r\n}","export const wsController = (ws, res) => {\r\n    const {channel, data} = res\r\n\r\n    switch (channel) {\r\n        case \"welcome\": {\r\n            console.log(`Welcome to SQL Navigator Server`)\r\n            break\r\n        }\r\n    }\r\n}\r\n","import \"../less/index.less\"\r\nimport View from \"./view.js\"\r\nimport WS from \"./ws.js\";\r\nimport {wsController} from \"./ws-controller.js\";\r\n\r\nglobalThis.ws = new WS({host: \"localhost\", secure: false, controller: wsController})\r\nglobalThis.view = new View()"],"names":[],"mappings":"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"}